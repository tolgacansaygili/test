<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>TV PWA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#111111">

  <!-- Manifest içeriği -->
  <link rel="manifest" href="data:application/manifest+json,{
    &quot;name&quot;:&quot;Canlı TV&quot;,
    &quot;short_name&quot;:&quot;TV&quot;,
    &quot;start_url&quot;:&quot;.&quot;,
    &quot;display&quot;:&quot;standalone&quot;,
    &quot;background_color&quot;:&quot;%23000000&quot;,
    &quot;theme_color&quot;:&quot;%23111111&quot;,
    &quot;orientation&quot;:&quot;portrait&quot;,
    &quot;icons&quot;:[
      {
        &quot;src&quot;:&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAYAAACt...&quot;,
        &quot;sizes&quot;:&quot;192x192&quot;,
        &quot;type&quot;:&quot;image/png&quot;
      },
      {
        &quot;src&quot;:&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAIAAAB7...&quot;,
        &quot;sizes&quot;:&quot;512x512&quot;,
        &quot;type&quot;:&quot;image/png&quot;
      }
    ]
  }">

  <!-- Favicon (Base64 PNG) -->
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA...">

  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      margin: 0;
      background-color: #000;
      font-family: sans-serif;
      color: white;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    #video-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    video, iframe {
      width: 100%;
      height: 100%;
      max-height: 100vh;
      border: none;
    }

    #channel-bar {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #111;
      overflow-x: auto;
      display: flex;
      border-top: 1px solid #333;
      z-index: 999;
    }

    #channel-bar ul {
      display: flex;
      padding: 0;
      margin: 0;
      list-style: none;
    }

    #channel-bar li {
      padding: 10px 15px;
      white-space: nowrap;
      cursor: pointer;
      flex-shrink: 0;
      transition: background 0.3s;
    }

    #channel-bar li.active {
      background-color: #444;
      font-weight: bold;
    }

    ::-webkit-scrollbar {
      height: 6px;
    }

    ::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 10px;
    }
  </style>
</head>
<body>

<div id="video-container">
  <video id="video" controls autoplay style="display: none;"></video>
  <iframe id="youtube-frame" allow="autoplay; encrypted-media" allowfullscreen style="display: none;"></iframe>
</div>

<div id="channel-bar">
  <ul>
    <li data-type="youtube" data-src="ztmY_cCtUl0">SÖZCÜ TV</li>
    <li data-type="youtube" data-src="ZSWPj9szKb8">HALK TV</li>
    <li data-type="youtube" data-src="fNqmmqNNGp8">TELE 1</li>
    <li data-src="https://tv-trt1.medya.trt.com.tr/master.m3u8">TRT1</li>
    <li data-src="https://tv-trt2.medya.trt.com.tr/master_720.m3u8">TRT 2</li>
    <li data-src="https://tv-trtbelgesel.medya.trt.com.tr/master.m3u8">TRT BELGESEL</li>
    <li data-src="https://dogus-live.daioncdn.net/tlc/tlc_720p.m3u8">TLC</li>
    <li data-src="https://tv-trtspor1.medya.trt.com.tr/master.m3u8">TRT SPOR</li>
    <li data-src="https://tv-trtspor2.medya.trt.com.tr/master.m3u8">TRT YILDIZ SPOR</li>
    <li data-src="https://master.nhkworld.jp/nhkworld-tv/playlist/live.m3u8">NHK WORLD</li>
    <li data-src="https://live.france24.com/hls/live/2037218-b/F24_EN_HI_HLS/master_5000.m3u8">FRANCE 24</li>
    <li data-src="https://live-hls-web-aje.getaj.net/AJE/index.m3u8">AL JAZEERA</li>
    <li data-src="https://d3pvma9xb2775h.cloudfront.net/live/omropfryslan/f8f68bd5/playlist.m3u8">Omrop NL</li>
    <li data-src="https://svs.itworkscdn.net/smc4sportslive/smc4.smil/smc4sportspublish/smc4tv_720p/chunks.m3u8">SPORT UZ</li>
    <li data-src="https://live-fi.tvkaista.net/tv5/live.m3u8">TV5 FINLAND</li>
  </ul>
</div>

<script>
  const video = document.getElementById('video');
  const youtubeFrame = document.getElementById('youtube-frame');
  const listItems = document.querySelectorAll('#channel-bar li');
  let currentIndex = 0;

  function playStream(url, element, type = 'hls') {
    listItems.forEach(li => li.classList.remove('active'));
    element.classList.add('active');
    currentIndex = Array.from(listItems).indexOf(element);

    if (type === 'youtube') {
      video.style.display = 'none';
      video.src = '';
      youtubeFrame.style.display = 'block';
      youtubeFrame.src = `https://www.youtube.com/embed/${url}?autoplay=1&vq=hd720`;
    } else {
      youtubeFrame.style.display = 'none';
      youtubeFrame.src = '';
      video.style.display = 'block';

      if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
      } else {
        alert("Tarayıcınız HLS desteklemiyor.");
      }
    }
  }

  listItems.forEach(item => {
    item.addEventListener('click', () => {
      const url = item.getAttribute('data-src');
      const type = item.getAttribute('data-type') || 'hls';
      playStream(url, item, type);
    });
  });

  document.getElementById('video-container').addEventListener('touchstart', (e) => {
    touchStartX = e.changedTouches[0].screenX;
  });

  document.getElementById('video-container').addEventListener('touchend', (e) => {
    const touchEndX = e.changedTouches[0].screenX;
    const diff = touchEndX - touchStartX;
    if (Math.abs(diff) > 50) {
      if (diff < 0 && currentIndex < listItems.length - 1) {
        listItems[currentIndex + 1].click();
      } else if (diff > 0 && currentIndex > 0) {
        listItems[currentIndex - 1].click();
      }
    }
  });

  if (listItems.length > 0) {
    const first = listItems[0];
    const url = first.getAttribute('data-src');
    const type = first.getAttribute('data-type') || 'hls';
    playStream(url, first, type);
  }
</script>

<!-- Dahili Service Worker kaydı -->
<script>
  const swCode = `
    const CACHE_NAME = "tv-app-cache-v1";
    const urlsToCache = ["./"];

    self.addEventListener("install", event => {
      event.waitUntil(
        caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache))
      );
    });

    self.addEventListener("fetch", event => {
      event.respondWith(
        caches.match(event.request).then(response => response || fetch(event.request))
      );
    });
  `;

  if ('serviceWorker' in navigator) {
    const blob = new Blob([swCode], { type: 'application/javascript' });
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl).then(
      registration => console.log('Service Worker kayıtlı:', registration.scope),
      err => console.log('Service Worker hatası:', err)
    );
  }
</script>

</body>
</html>
